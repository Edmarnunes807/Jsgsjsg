<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scanner de Produtos</title>

  <!-- QuaggaJS -->
  <script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: #fff;
      width: 100%;
      max-width: 420px;
      padding: 20px;
      border-radius: 18px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.35);
    }

    h1 {
      text-align: center;
      margin-bottom: 15px;
      font-size: 22px;
    }

    .input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }

    .btn {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 12px;
      background: #2c5364;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
      margin-bottom: 10px;
    }

    .btn:hover {
      background: #203a43;
    }

    #scanner {
      display: none;
      margin-top: 10px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }

    /* Moldura visual de foco */
    #scanner::after {
      content: "";
      position: absolute;
      top: 30%;
      left: 15%;
      right: 15%;
      bottom: 30%;
      border: 2px dashed rgba(255,255,255,0.8);
      pointer-events: none;
    }

    #scanner video {
      width: 100%;
    }

    .resultado {
      display: none;
      margin-top: 15px;
      background: #f4f6f8;
      border-radius: 14px;
      padding: 15px;
      text-align: center;
    }

    .resultado img {
      max-width: 100%;
      max-height: 220px;
      object-fit: contain;
      margin-bottom: 10px;
    }

    .linha {
      margin: 6px 0;
      font-size: 15px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>游닍 Scanner de Produtos</h1>

  <input
    type="text"
    id="codigoManual"
    class="input"
    placeholder="Digite o c칩digo de barras"
    inputmode="numeric"
  />

  <button class="btn" onclick="buscarCodigoManual()">游댌 Buscar C칩digo</button>
  <button class="btn" onclick="iniciarScanner()">游닝 Abrir Scanner</button>

  <div id="scanner"></div>

  <div class="resultado" id="resultado">
    <img id="imagemProduto" style="display:none;">
    <div class="linha"><strong>C칩digo:</strong> <span id="codigo"></span></div>
    <div class="linha"><strong>Produto:</strong> <span id="nome"></span></div>
    <div class="linha"><strong>Marca:</strong> <span id="marca"></span></div>
    <div class="linha"><strong>Quantidade:</strong> <span id="quantidade"></span></div>
  </div>
</div>

<script>
let scannerAtivo = false;

function iniciarScanner() {
  if (scannerAtivo) return;

  const scannerDiv = document.getElementById("scanner");
  scannerDiv.style.display = "block";

  Quagga.init({
    inputStream: {
      type: "LiveStream",
      target: scannerDiv,
      constraints: {
        facingMode: "environment",
        width: { ideal: 1280 },
        height: { ideal: 720 },
        advanced: [
          { zoom: 2.0 },
          { focusMode: "continuous" }
        ]
      },
      area: {
        top: "30%",
        right: "15%",
        left: "15%",
        bottom: "30%"
      }
    },
    locator: {
      patchSize: "medium",
      halfSample: false
    },
    numOfWorkers: navigator.hardwareConcurrency || 4,
    decoder: {
      readers: ["ean_reader", "ean_8_reader", "upc_reader"]
    },
    locate: true
  }, err => {
    if (err) {
      alert("Erro ao acessar a c칙mera");
      return;
    }
    Quagga.start();
    scannerAtivo = true;
  });

  Quagga.offDetected();
  Quagga.onDetected(data => {
    const codigo = data.codeResult.code;
    Quagga.stop();
    scannerAtivo = false;
    buscarProduto(codigo);
  });
}

function buscarCodigoManual() {
  const codigo = document.getElementById("codigoManual").value.trim();
  if (!codigo) {
    alert("Digite um c칩digo v치lido");
    return;
  }
  buscarProduto(codigo);
}

function buscarProduto(codigo) {
  fetch(`https://world.openfoodfacts.org/api/v0/product/${codigo}.json`)
    .then(res => res.json())
    .then(data => {
      const resultado = document.getElementById("resultado");
      const img = document.getElementById("imagemProduto");

      resultado.style.display = "block";
      document.getElementById("codigo").innerText = codigo;

      if (data.status !== 1) {
        document.getElementById("nome").innerText = "Produto n칚o encontrado";
        document.getElementById("marca").innerText = "-";
        document.getElementById("quantidade").innerText = "-";
        img.style.display = "none";
        return;
      }

      const p = data.product;

      document.getElementById("nome").innerText = p.product_name || "N칚o informado";
      document.getElementById("marca").innerText = p.brands || "N칚o informada";
      document.getElementById("quantidade").innerText = p.quantity || "N칚o informada";

      if (p.image_front_url) {
        img.src = p.image_front_url;
        img.style.display = "block";
      } else {
        img.style.display = "none";
      }
    });
}
</script>

</body>
</html>
